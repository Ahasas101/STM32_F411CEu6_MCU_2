#include "stm32f4xx_hal.h"
#include "FreeRTOS.h"
#include "task.h"



TaskHandle_t CapChargeHandle;
TaskHandle_t AdcReadHandle;
TaskHandle_t CapDischargeHandle;
TaskHandle_t LcdPrintHandle;

void CapChargeTaskHandler(void* parameters);
void AdcReadTaskHandler(void* parameters);
void CapDischargeTaskHandler(void* parameters);
void LcdPrintTaskHandler(void* parameters);

void SystemClockConfig(void);
void GpioSwoInit(void);

void GpioCapInit(void);


int main(void)
{
	HAL_Init();

	BaseType_t status;

	status = xTaskCreate(CapChargeTaskHandler, "CapChargeTask", 200, NULL, 4, &CapChargeHandle);
	configASSERT(status == pdPASS);

	status = xTaskCreate(AdcReadTaskHandler, "AdcReadTask", 200, NULL, 4, &AdcReadHandle);
	configASSERT(status == pdPASS);

	status = xTaskCreate(CapDischargeTaskHandler, "CapDischargeTask", 200, NULL, 4, &CapDischargeHandle);
	configASSERT(status == pdPASS);

	status = xTaskCreate(LcdPrintTaskHandler, "LcdPrintTask", 200, NULL, 4, &LcdPrintHandle);
	configASSERT(status == pdPASS);

	vTaskStartScheduler();

	return 0;
}

void SystemClockConfig(void)
{

}

void GpioSwoInit(void)
{
	__HAL_RCC_GPIOB_CLK_ENABLE();
	GPIO_InitTypeDef gpio_swo;
	gpio_swo.Mode = GPIO_MODE_AF_PP;
	gpio_swo.Pin = GPIO_PIN_3;
	gpio_swo.Alternate = GPIO_AF0_SWJ;
	gpio_swo.Pull = GPIO_NOPULL;
	gpio_swo.Speed = GPIO_SPEED_FREQ_LOW;
	HAL_GPIO_Init(GPIOB, &gpio_swo);
}

void GpioCapInit(void)
{
	__HAL_RCC_GPIOA_CLK_ENABLE();
	GPIO_InitTypeDef gpio_cap;
	gpio_cap.Mode = GPIO_MODE_OUTPUT_PP;
	gpio_cap.Pin = GPIO_PIN_0;
	gpio_cap.Pull = GPIO_NOPULL;
	gpio_cap.Speed = GPIO_SPEED_MEDIUM;
	HAL_GPIO_Init(GPIOA, &gpio_cap);
}


void CapChargeTaskHandler(void* parameters)
{
	while(1)
	{
		HAL_GPIO_WritePin(GPIOA, GPIO_PIN_0, GPIO_PIN_SET);
		vTaskDelay(pdMS_TO_TICKS(1000));
		xTaskNotify(AdcReadHandle, NULL, eNoAction);
	}
}

void AdcReadTaskHandler(void* parameters)
{
	HAL_

}

void CapDischargeTaskHandler(void* parameters)
{

}

void LcdPrintTaskHandler(void* parameters)
{

}

